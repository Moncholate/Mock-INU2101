<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Test - Ingl√©s B√°sico II</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin-left: 20px;
        }
        
        .info-box li {
            margin: 5px 0;
        }
        
        .student-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .student-info label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #1976d2;
        }
        
        .student-info input {
            width: 100%;
            padding: 10px;
            border: 2px solid #1976d2;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .section {
            margin: 40px 0;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .section-title {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-subtitle {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .tip-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .tip-box::before {
            content: "üí° ";
            font-size: 1.2em;
        }
        
        .audio-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        
        audio {
            width: 100%;
            margin: 10px 0;
        }
        
        .play-counter {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #667eea;
        }
        
        .play-counter.warning {
            color: #ff6b6b;
        }
        
        .question {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .options {
            margin: 10px 0;
        }
        
        .option-label {
            display: block;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-label:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-top: 5px;
        }
        
        .verb-box {
            background: #e8eaf6;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #5e35b1;
        }
        
        .reading-text {
            background: white;
            padding: 25px;
            border-radius: 8px;
            line-height: 1.8;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }
        
        .email-header {
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            margin: 10px 0;
        }
        
        .word-counter {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .rubric-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .rubric-title {
            color: #4caf50;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .rubric-criterion {
            margin: 20px 0;
            padding: 15px;
            background: #f1f8f4;
            border-radius: 8px;
        }
        
        .criterion-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .rubric-option {
            margin: 8px 0;
        }
        
        .rubric-option label {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .rubric-option label:hover {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        
        .rubric-option input[type="radio"] {
            margin-right: 10px;
            margin-top: 3px;
            flex-shrink: 0;
            min-width: 16px;
        }
        
        .rubric-option-content {
            flex-grow: 1;
        }
        
        .rubric-option-content strong {
            display: block;
            color: #2e7d32;
            margin-bottom: 3px;
        }
        
        .rubric-option-content p {
            margin: 0;
            font-size: 0.95em;
            color: #555;
            line-height: 1.4;
        }
        
        .email-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            width: 100%;
            margin: 20px 0;
            transition: all 0.3s;
        }
        
        .email-button:hover {
            background: #f57c00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .submit-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3em;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            width: 100%;
            margin: 30px 0;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .submit-button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .results {
            background: #f1f8f4;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            border: 3px solid #4caf50;
            display: none;
        }
        
        .results h2 {
            color: #2e7d32;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .score-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .score-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .score-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2em;
            color: #2e7d32;
        }
        
        .final-grade {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .final-grade h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .final-grade .grade-number {
            font-size: 4em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .feedback-section {
            margin-top: 30px;
        }
        
        .feedback-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }
        
        .feedback-item.correct {
            border-left-color: #4caf50;
            background: #f1f8f4;
        }
        
        .feedback-item.incorrect {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .feedback-item.partial {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        
        .feedback-question {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .feedback-answer {
            margin: 5px 0;
        }
        
        .feedback-answer.correct {
            color: #2e7d32;
        }
        
        .feedback-answer.incorrect {
            color: #c62828;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #f44336;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .section {
                padding: 20px;
            }
            
            .rubric-option label {
                flex-direction: column;
            }
            
            input[type="radio"] {
                margin-bottom: 8px;
            }
        }
        
        /* Inline radio button styling */
        .question-text label {
            transition: all 0.3s ease;
        }
        
        .question-text label:hover {
            background: #e3f2fd !important;
            transform: scale(1.05);
        }
        
        .question-text input[type="radio"]:checked + span {
            font-weight: bold;
        }
        
        .question-text label:has(input[type="radio"]:checked) {
            background: #c5e1a5 !important;
            border: 2px solid #4caf50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù Mock Test Interactivo</h1>
        <p class="subtitle">Ingl√©s B√°sico II - Midterm Practice Test</p>
        
        <div class="info-box">
            <h3>üìã Instrucciones Generales</h3>
            <ul>
                <li><strong>Tiempo estimado:</strong> 60 minutos</li>
                <li><strong>Puntaje total:</strong> 36 puntos (12 Listening + 12 Reading + 12 Writing)</li>
                <li>Los audios se pueden reproducir <strong>m√°ximo 2 veces</strong></li>
                <li>Lee las preguntas antes de escuchar los audios</li>
                <li>Para el Writing, debes <strong>enviar tu texto por email</strong> al profesor antes de calcular tu nota</li>
                <li>Completa todos los campos antes de enviar</li>
            </ul>
        </div>
        
        <div class="student-info">
            <label for="studentName">üìõ Tu nombre completo:</label>
            <input type="text" id="studentName" placeholder="Ejemplo: Juan P√©rez Gonz√°lez" required>
        </div>
        
        <!-- LISTENING SECTION -->
        <div class="section">
            <h2 class="section-title">üéß I. Listening Comprehension (12 points)</h2>
            
            <div class="tip-box">
                Antes de escuchar los audios, revisa las preguntas cuidadosamente. Esto te ayudar√° a identificar r√°pidamente la informaci√≥n clave que necesitas.
            </div>
            
            <!-- LISTENING PART A -->
            <div style="margin-top: 30px;">
                <h3 class="section-subtitle">Part A: Street Interview (6 points)</h3>
                <p><strong>Listen to a journalist interviewing two people on the street about what they do on the weekend. Circle the correct option to complete each sentence.</strong></p>
                
                <div class="audio-container">
                    <p style="font-weight: bold; color: #667eea;">üîä Audio - Part A</p>
                    <audio id="audioA" controls preload="metadata" playsinline>
                        <source src="https://github.com/Moncholate/Mock-INU2101/raw/refs/heads/main/Listening%20-%20Part%20A.mp3" type="audio/mpeg">
                        Tu navegador no soporta el elemento de audio.
                    </audio>
                    <div class="play-counter" id="counterA">Reproducciones: 0 / 2</div>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">1.</span>
                        The woman and the man are 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q1" value="coworkers" style="margin: 0 5px 0 0;">
                            <span>COWORKERS</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q1" value="friends" style="margin: 0 5px 0 0;">
                            <span>FRIENDS</span>
                        </label>.
                    </p>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">2.</span>
                        The woman works at a 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q2" value="coffee shop" style="margin: 0 5px 0 0;">
                            <span>COFFEE SHOP</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q2" value="bookstore" style="margin: 0 5px 0 0;">
                            <span>BOOKSTORE</span>
                        </label>.
                    </p>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">3.</span>
                        After work, the woman usually 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q3" value="watches tv" style="margin: 0 5px 0 0;">
                            <span>WATCHES TV</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q3" value="goes shopping" style="margin: 0 5px 0 0;">
                            <span>GOES SHOPPING</span>
                        </label>.
                    </p>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">4.</span>
                        On Saturday, the man 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q4" value="goes to the gym" style="margin: 0 5px 0 0;">
                            <span>GOES TO THE GYM</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q4" value="goes to the park" style="margin: 0 5px 0 0;">
                            <span>GOES TO THE PARK</span>
                        </label>
                        with his friends.
                    </p>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">5.</span>
                        On Sunday morning, the man 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q5" value="sleeps late" style="margin: 0 5px 0 0;">
                            <span>SLEEPS LATE</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q5" value="gets up early" style="margin: 0 5px 0 0;">
                            <span>GETS UP EARLY</span>
                        </label>.
                    </p>
                </div>
                
                <div class="question">
                    <p class="question-text">
                        <span style="margin-right: 10px;">6.</span>
                        On Sunday afternoon, the woman 
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q6" value="visits her parents" style="margin: 0 5px 0 0;">
                            <span>VISITS HER PARENTS</span>
                        </label>
                        /
                        <label style="display: inline; cursor: pointer; padding: 3px 8px; background: #f0f0f0; border-radius: 3px; margin: 0 3px; border: 2px solid transparent;">
                            <input type="radio" name="q6" value="reads books" style="margin: 0 5px 0 0;">
                            <span>READS BOOKS</span>
                        </label>.
                    </p>
                </div>
            </div>
            
            <!-- LISTENING PART B -->
            <div style="margin-top: 40px;">
                <h3 class="section-subtitle">Part B: Movie Conversation (6 points)</h3>
                <p><strong>Listen to a conversation about movies. Circle T for true statements or F for false statements. Provide the correct information for false statements.</strong></p>
                
                <div class="audio-container">
                    <p style="font-weight: bold; color: #667eea;">üîä Audio - Part B</p>
                    <audio id="audioB" controls preload="metadata" playsinline>
                        <source src="https://github.com/Moncholate/Mock-INU2101/raw/refs/heads/main/Listening%20-%20Part%20B.mp3" type="audio/mpeg">
                        Tu navegador no soporta el elemento de audio.
                    </audio>
                    <div class="play-counter" id="counterB">Reproducciones: 0 / 2</div>
                </div>
                
                <div class="question">
                    <p class="question-text">1. The people are watching a movie at the cinema.</p>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="q7" value="true"> TRUE
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q7" value="false"> FALSE
                        </label>
                    </div>
                    <input type="text" id="q7correction" placeholder="If FALSE, write the correct information here">
                </div>
                
                <div class="question">
                    <p class="question-text">2. The woman likes Tom Cruise movies.</p>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="q8" value="true"> TRUE
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q8" value="false"> FALSE
                        </label>
                    </div>
                    <input type="text" id="q8correction" placeholder="If FALSE, write the correct information here">
                </div>
                
                <div class="question">
                    <p class="question-text">3. The man doesn't like action movies.</p>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="q9" value="true"> TRUE
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q9" value="false"> FALSE
                        </label>
                    </div>
                    <input type="text" id="q9correction" placeholder="If FALSE, write the correct information here">
                </div>
                
                <div class="question">
                    <p class="question-text">4. They are watching an action movie.</p>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="q10" value="true"> TRUE
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q10" value="false"> FALSE
                        </label>
                    </div>
                    <input type="text" id="q10correction" placeholder="If FALSE, write the correct information here">
                </div>
            </div>
        </div>
        
        <!-- READING SECTION -->
        <div class="section">
            <h2 class="section-title">üìñ II. Reading Comprehension (12 points)</h2>
            
            <!-- READING PART A -->
            <div style="margin-top: 30px;">
                <h3 class="section-subtitle">Part A: Barcelona Travel Guide (6 points)</h3>
                <p><strong>Read the text about Barcelona below and fill in the gaps with CAN or CAN'T and a VERB from the box, so the sentences make sense.</strong></p>
                
                <div class="verb-box">
                    eat ‚Äì see ‚Äì drive ‚Äì speak ‚Äì take photos ‚Äì swim
                </div>
                
                <div class="reading-text">
                    <h4 style="color: #764ba2; margin-bottom: 15px;">In Barcelona‚Ä¶</h4>
                    
                    <div class="question">
                        <p class="question-text">1. You <input type="text" id="q11" style="width: 250px; display: inline-block;"> delicious paella at the local restaurants.</p>
                    </div>
                    
                    <div class="question">
                        <p class="question-text">2. Tourists <input type="text" id="q12" style="width: 250px; display: inline-block;"> beautiful buildings by Gaud√≠ everywhere in the city.</p>
                    </div>
                    
                    <div class="question">
                        <p class="question-text">3. You <input type="text" id="q13" style="width: 250px; display: inline-block;"> a car in the city center. It's prohibited!</p>
                    </div>
                    
                    <div class="question">
                        <p class="question-text">4. People <input type="text" id="q14" style="width: 250px; display: inline-block;"> Spanish and English in Miami. The city is multicultural!</p>
                    </div>
                    
                    <div class="question">
                        <p class="question-text">5. You <input type="text" id="q15" style="width: 250px; display: inline-block;"> photos in the museums. Photography is not permitted.</p>
                    </div>
                    
                    <div class="question">
                        <p class="question-text">6. You <input type="text" id="q16" style="width: 250px; display: inline-block;"> on the beach at night. It's closed after 10pm.</p>
                    </div>
                </div>
            </div>
            
            <!-- READING PART B -->
            <div style="margin-top: 40px;">
                <h3 class="section-subtitle">Part B: Reading Comprehension (6 points)</h3>
                
                <div class="tip-box">
                    Antes de leer el texto, revisa las preguntas cuidadosamente. Esto te ayudar√° a identificar r√°pidamente la informaci√≥n clave que necesitas.
                </div>
                
                <p><strong>Read the text about David's weekend and answer the questions. Make sure you include all the relevant information in your answers, to demonstrate that you understand what you read.</strong></p>
                
                <div class="reading-text">
                    <p class="email-header">Hi Sarah!</p>
                    
                    <p>How are you? I want to tell you about my weekend! <strong>I'm spending the weekend at home with my roommate Tom and my sister Anna.</strong> I'm sending you some <strong>photos</strong> of the things we're doing.</p>
                    
                    <p>The first photo is of me at home. I'm cleaning my apartment. I know, it's boring! But I always clean on Saturday mornings. My roommate Tom is next to me. He's helping me. Tom is a very good roommate!</p>
                    
                    <p>The next photo is of me and Tom at a restaurant. We love this place! In this photo, we're having lunch with my sister Anna. She's visiting us this weekend.</p>
                    
                    <p>We don't usually cook at home on weekends, but Tom is a great cook. In the third photo, Tom is making pizza in the kitchen. I love his pizzas! They're delicious!</p>
                    
                    <p>I love sports, and I play basketball every weekend. In the next photo, I'm playing basketball with my friends at the park. Tom is watching us. He doesn't like sports very much.</p>
                    
                    <p>Everything is great this weekend, but there is one thing I'm not enjoying: the weather is very cold and rainy. I don't like cold weather!</p>
                    
                    <p><strong>Today is the last day of the weekend,</strong> and right now, it's Sunday evening. We're at home. Tom is watching a movie on TV, and I'm writing this message to you. Anna is sleeping on the sofa. She's very tired!</p>
                    
                    <p>See you soon!</p>
                    <p>David.</p>
                </div>
                
                <div class="question">
                    <p class="question-text">1. Where is David spending the weekend? (1 point)</p>
                    <input type="text" id="q17" placeholder="Write your answer here">
                </div>
                
                <div class="question">
                    <p class="question-text">2. What is Tom doing in the third photo? (1 point)</p>
                    <input type="text" id="q18" placeholder="Write your answer here">
                </div>
                
                <div class="question">
                    <p class="question-text">3. Is David having a good weekend? Why? Provide at least two (2) ideas. (2 points)</p>
                    <input type="text" id="q19" placeholder="Write your answer here">
                </div>
                
                <div class="question">
                    <p class="question-text">4. What are they doing on the last day of the weekend? Provide at least two (2) ideas. (2 points)</p>
                    <input type="text" id="q20" placeholder="Write your answer here">
                </div>
            </div>
        </div>
        
        <!-- WRITING SECTION -->
        <div class="section">
            <h2 class="section-title">‚úçÔ∏è III. Writing (12 points)</h2>
            
            <div class="info-box" style="border-left-color: #ff9800;">
                <h3 style="color: #ff9800;">‚ö†Ô∏è IMPORTANTE - Proceso de Writing</h3>
                <ol>
                    <li>Escribe tu texto en el cuadro de abajo (m√≠nimo 40 palabras)</li>
                    <li>Haz clic en el bot√≥n naranja "Enviar Writing por Email"</li>
                    <li>Se abrir√° tu correo con el texto - env√≠alo a tu profesor</li>
                    <li>Espera a que el profesor revise y te env√≠e los puntajes</li>
                    <li>Ingresa los puntajes en la r√∫brica interactiva m√°s abajo</li>
                    <li>Finalmente, calcula tu nota final con el bot√≥n verde</li>
                </ol>
            </div>
            
            <div style="background: white; padding: 25px; border-radius: 8px; margin: 20px 0;">
                <p><strong>Tell us about things you do in the summer, in at least 40 words.</strong></p>
                <p style="margin: 15px 0;">Include ideas about the following topics:</p>
                <ul style="margin-left: 30px; margin-bottom: 15px;">
                    <li>Things you like, love and hate doing.</li>
                    <li>Something you usually have to do.</li>
                    <li>People you spend time with.</li>
                </ul>
                <p style="color: #d32f2f; font-weight: bold;">‚ö†Ô∏è Remember to check your vocabulary, grammar and spelling, and to include ONLY original ideas. Do not copy ideas from this test.</p>
                
                <textarea id="writingText" placeholder="Write your text here..."></textarea>
                <div class="word-counter" id="wordCounter">Words: 0 / 40 minimum</div>
            </div>
            
            <button class="email-button" onclick="sendWritingEmail()">
                üìß Enviar Writing por Email al Profesor
            </button>
            
            <div class="rubric-section">
                <h3 class="rubric-title">üìä R√∫brica de Evaluaci√≥n - Writing (12 puntos)</h3>
                <p style="margin-bottom: 20px; color: #666;">Una vez que el profesor te env√≠e los puntajes, ingr√©salos aqu√≠ seleccionando el nivel correspondiente en cada criterio:</p>
                
                <!-- Criterio 1: Coherencia y Extensi√≥n -->
                <div class="rubric-criterion">
                    <div class="criterion-title">1. Coherencia y Extensi√≥n (4 puntos)</div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric1" value="4">
                            <div class="rubric-option-content">
                                <strong>Totalmente Logrado - 4 puntos</strong>
                                <p>Escribe 40 palabras o m√°s. Desarrolla al menos 5 ideas completas y coherentes con el est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric1" value="3.2">
                            <div class="rubric-option-content">
                                <strong>Logrado - 3.2 puntos</strong>
                                <p>Escribe de 30 a 39 palabras. Desarrolla al menos 4 ideas completas y coherentes con el est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric1" value="2.4">
                            <div class="rubric-option-content">
                                <strong>Parcialmente Logrado - 2.4 puntos</strong>
                                <p>Escribe de 20 a 29 palabras. Desarrolla al menos 3 ideas completas y coherentes con el est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric1" value="1.2">
                            <div class="rubric-option-content">
                                <strong>Insuficientemente Logrado - 1.2 puntos</strong>
                                <p>Escribe de 10 a 19 palabras. Desarrolla 2 ideas completas y coherentes con el est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric1" value="0">
                            <div class="rubric-option-content">
                                <strong>No Logrado - 0 puntos</strong>
                                <p>No hay respuesta o escribe menos de 10 palabras.</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Criterio 2: Vocabulario -->
                <div class="rubric-criterion">
                    <div class="criterion-title">2. Vocabulario (3 puntos)</div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric2" value="3">
                            <div class="rubric-option-content">
                                <strong>Totalmente Logrado - 3 puntos</strong>
                                <p>Al menos 8 palabras del vocabulario estudiado, en contextos adecuados y acorde al est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric2" value="2.4">
                            <div class="rubric-option-content">
                                <strong>Logrado - 2.4 puntos</strong>
                                <p>Entre 6 y 7 palabras del vocabulario estudiado, en contextos adecuados y acorde al est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric2" value="1.8">
                            <div class="rubric-option-content">
                                <strong>Parcialmente Logrado - 1.8 puntos</strong>
                                <p>Al menos 5 palabras del vocabulario estudiado, en contextos adecuados y acorde al est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric2" value="0.9">
                            <div class="rubric-option-content">
                                <strong>Insuficientemente Logrado - 0.9 puntos</strong>
                                <p>Entre 3 y 4 palabras del vocabulario estudiado, en contextos adecuados y acorde al est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric2" value="0">
                            <div class="rubric-option-content">
                                <strong>No Logrado - 0 puntos</strong>
                                <p>No hay respuesta o incluye menos de 3 palabras del vocabulario y/o no se ajustan al est√≠mulo.</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Criterio 3: Gram√°tica -->
                <div class="rubric-criterion">
                    <div class="criterion-title">3. Gram√°tica (3 puntos)</div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric3" value="3">
                            <div class="rubric-option-content">
                                <strong>Totalmente Logrado - 3 puntos</strong>
                                <p>Aplica reglas gramaticales, conjuga verbos y estructura oraciones correctamente sin errores.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric3" value="2.4">
                            <div class="rubric-option-content">
                                <strong>Logrado - 2.4 puntos</strong>
                                <p>Aplica reglas correctamente en la mayor√≠a de casos, con 2 a 3 errores que no afectan la comprensi√≥n.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric3" value="1.8">
                            <div class="rubric-option-content">
                                <strong>Parcialmente Logrado - 1.8 puntos</strong>
                                <p>Aplica reglas correctamente en algunos casos, con 4 a 5 errores, pero el texto es comprensible.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric3" value="0.9">
                            <div class="rubric-option-content">
                                <strong>Insuficientemente Logrado - 0.9 puntos</strong>
                                <p>Aplica estructuras incorrectamente en muchos casos, con hasta 6 errores que limitan la claridad.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric3" value="0">
                            <div class="rubric-option-content">
                                <strong>No Logrado - 0 puntos</strong>
                                <p>No hay respuesta o hay 7 o m√°s errores gramaticales que impiden la comprensi√≥n.</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Criterio 4: Ortograf√≠a -->
                <div class="rubric-criterion">
                    <div class="criterion-title">4. Ortograf√≠a (2 puntos)</div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric4" value="2">
                            <div class="rubric-option-content">
                                <strong>Totalmente Logrado - 2 puntos</strong>
                                <p>Hay 1 o 2 errores de ortograf√≠a que no afectan el mensaje.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric4" value="1.6">
                            <div class="rubric-option-content">
                                <strong>Logrado - 1.6 puntos</strong>
                                <p>Hay 3 o 4 errores de ortograf√≠a que no afectan en general el mensaje del texto.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric4" value="1.2">
                            <div class="rubric-option-content">
                                <strong>Parcialmente Logrado - 1.2 puntos</strong>
                                <p>Hay 5 o 6 errores de ortograf√≠a que afectan parcialmente el mensaje del texto.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric4" value="0.6">
                            <div class="rubric-option-content">
                                <strong>Insuficientemente Logrado - 0.6 puntos</strong>
                                <p>Hay de 7 a 9 errores de ortograf√≠a que afectan la idea principal del mensaje.</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="rubric-option">
                        <label>
                            <input type="radio" name="rubric4" value="0">
                            <div class="rubric-option-content">
                                <strong>No Logrado - 0 puntos</strong>
                                <p>Hay m√°s de 10 errores de ortograf√≠a que afectan la idea principal del mensaje.</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SUBMIT BUTTON -->
        <button class="submit-button" onclick="calculateGrade()">
            üéØ Calcular Mi Nota Final
        </button>
        
        <!-- RESULTS SECTION -->
        <div class="results" id="results">
            <h2>üìä Resultados del Mock Test</h2>
            
            <div class="final-grade">
                <h3>Tu Nota Final</h3>
                <div class="grade-number" id="finalGrade">-</div>
                <p id="gradeMessage"></p>
            </div>
            
            <div class="score-summary">
                <h3 style="color: #764ba2; margin-bottom: 15px;">Detalle de Puntajes</h3>
                <div class="score-row">
                    <span>Listening Comprehension:</span>
                    <span id="listeningScore">- / 12</span>
                </div>
                <div class="score-row">
                    <span>Reading Comprehension:</span>
                    <span id="readingScore">- / 12</span>
                </div>
                <div class="score-row">
                    <span>Writing:</span>
                    <span id="writingScore">- / 12</span>
                </div>
                <div class="score-row">
                    <span>PUNTAJE TOTAL:</span>
                    <span id="totalScore">- / 36</span>
                </div>
                <div class="score-row">
                    <span>PORCENTAJE:</span>
                    <span id="percentage">- %</span>
                </div>
            </div>
            
            <div class="feedback-section">
                <h3 style="color: #764ba2; margin: 20px 0;">Feedback Detallado</h3>
                <div id="feedbackContainer"></div>
            </div>
            
            <div class="rubric-section" id="manualOverride" style="display: none; border-color: #ff9800;">
                <h3 style="color: #ff9800; margin-bottom: 15px;">‚öôÔ∏è Ajuste Manual de Puntajes - Reading Comprehension</h3>
                <p style="margin-bottom: 20px; color: #666;">Si necesitas ajustar los puntajes autom√°ticos del Reading, ingresa los nuevos valores aqu√≠ y haz clic en "Recalcular con Ajustes":</p>
                
                <h4 style="color: #764ba2; margin: 20px 0 10px 0;">Reading Part A - Barcelona (6 puntos)</h4>
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; margin-bottom: 10px; font-weight: bold; color: #764ba2;">
                        <div>Pregunta</div>
                        <div style="text-align: center;">Puntaje Auto</div>
                        <div style="text-align: center;">Nuevo Puntaje</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 1 (paella)</div>
                        <div style="text-align: center;"><span id="autoScore11">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore11" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 2 (buildings)</div>
                        <div style="text-align: center;"><span id="autoScore12">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore12" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 3 (drive car)</div>
                        <div style="text-align: center;"><span id="autoScore13">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore13" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 4 (Miami languages)</div>
                        <div style="text-align: center;"><span id="autoScore14">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore14" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 5 (photos museums)</div>
                        <div style="text-align: center;"><span id="autoScore15">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore15" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 6 (beach night)</div>
                        <div style="text-align: center;"><span id="autoScore16">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore16" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                </div>
                
                <h4 style="color: #764ba2; margin: 20px 0 10px 0;">Reading Part B - David's Weekend (6 puntos)</h4>
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; margin-bottom: 10px; font-weight: bold; color: #764ba2;">
                        <div>Pregunta</div>
                        <div style="text-align: center;">Puntaje Auto</div>
                        <div style="text-align: center;">Nuevo Puntaje</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 1 (Where is David spending...?)</div>
                        <div style="text-align: center;"><span id="autoScore17">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore17" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 2 (What is Tom doing...?)</div>
                        <div style="text-align: center;"><span id="autoScore18">-</span> / 1</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore18" min="0" max="1" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 3 (Is David having a good...?)</div>
                        <div style="text-align: center;"><span id="autoScore19">-</span> / 2</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore19" min="0" max="2" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                        <div>Question 4 (What are they doing...?)</div>
                        <div style="text-align: center;"><span id="autoScore20">-</span> / 2</div>
                        <div style="text-align: center;">
                            <input type="number" id="manualScore20" min="0" max="2" step="0.5" style="width: 80px; padding: 5px; text-align: center; border: 2px solid #ff9800; border-radius: 5px;">
                        </div>
                    </div>
                </div>
                
                <button style="background: #ff9800; color: white; border: none; padding: 15px 30px; font-size: 1.1em; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 15px; font-weight: bold;" onclick="recalculateWithOverrides()">
                    üîÑ Recalcular Nota con Ajustes Manuales
                </button>
                
                <p style="margin-top: 15px; color: #666; font-size: 0.9em; font-style: italic;">üí° Deja los campos vac√≠os si no necesitas ajustar ese puntaje espec√≠fico.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables for score storage
        let globalScores = {
            listening: 0,
            reading: 0,
            readingPartA: {
                q11: 0,
                q12: 0,
                q13: 0,
                q14: 0,
                q15: 0,
                q16: 0
            },
            readingPartB: {
                q17: 0,
                q18: 0,
                q19: 0,
                q20: 0
            },
            writing: 0,
            total: 0
        };
        
        // Audio play counter functionality
        let playCountA = 0;
        let playCountB = 0;
        
        const audioA = document.getElementById('audioA');
        const audioB = document.getElementById('audioB');
        const counterA = document.getElementById('counterA');
        const counterB = document.getElementById('counterB');
        
        audioA.addEventListener('play', function() {
            playCountA++;
            counterA.textContent = `Reproducciones: ${playCountA} / 2`;
            if (playCountA >= 2) {
                counterA.classList.add('warning');
                counterA.textContent = `‚ö†Ô∏è L√≠mite alcanzado: ${playCountA} / 2`;
            }
        });
        
        audioB.addEventListener('play', function() {
            playCountB++;
            counterB.textContent = `Reproducciones: ${playCountB} / 2`;
            if (playCountB >= 2) {
                counterB.classList.add('warning');
                counterB.textContent = `‚ö†Ô∏è L√≠mite alcanzado: ${playCountB} / 2`;
            }
        });
        
        // Word counter for writing
        const writingText = document.getElementById('writingText');
        const wordCounter = document.getElementById('wordCounter');
        
        writingText.addEventListener('input', function() {
            const text = this.value.trim();
            const words = text.length > 0 ? text.split(/\s+/).length : 0;
            wordCounter.textContent = `Words: ${words} / 40 minimum`;
            if (words >= 40) {
                wordCounter.style.color = '#4caf50';
                wordCounter.style.fontWeight = 'bold';
            } else {
                wordCounter.style.color = '#666';
                wordCounter.style.fontWeight = 'normal';
            }
        });
        
        // Send writing via email
        function sendWritingEmail() {
            const studentName = document.getElementById('studentName').value.trim();
            const writingText = document.getElementById('writingText').value.trim();
            
            if (!studentName) {
                alert('‚ö†Ô∏è Por favor ingresa tu nombre completo antes de enviar el Writing.');
                document.getElementById('studentName').focus();
                return;
            }
            
            if (!writingText) {
                alert('‚ö†Ô∏è Por favor escribe tu texto antes de enviarlo.');
                document.getElementById('writingText').focus();
                return;
            }
            
            const words = writingText.split(/\s+/).length;
            
            const subject = `Writing - Mock Test - ${studentName}`;
            const body = `Estudiante: ${studentName}
Cantidad de palabras: ${words}

TEXTO DEL WRITING:
${writingText}

---
Este correo fue generado autom√°ticamente desde el Mock Test Interactivo de Ingl√©s B√°sico II.`;
            
            const mailtoLink = `mailto:v.moralesm@profesor.duoc.cl?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            window.location.href = mailtoLink;
        }
        
        // Answer key
        const answerKey = {
            q1: 'friends',
            q2: 'coffee shop',
            q3: 'goes shopping',
            q4: 'goes to the park',
            q5: 'sleeps late',
            q6: 'visits her parents',
            q7: 'false',
            q8: 'true',
            q9: 'true',
            q10: 'false',
            q11: {
                modal: ['can', 'can eat', 'can have'],
                verb: ['eat', 'have'],
                fullAnswer: ['can eat', 'can have'],
                points: 1
            },
            q12: {
                modal: ['can', 'can see'],
                verb: ['see'],
                fullAnswer: ['can see'],
                points: 1
            },
            q13: {
                modal: ['cant', 'cannot', 'can not', 'cant drive', 'cannot drive', 'can not drive'],
                verb: ['drive'],
                fullAnswer: ['cant drive', 'cannot drive', 'can not drive'],
                points: 1
            },
            q14: {
                modal: ['can', 'can speak', 'can hear'],
                verb: ['speak', 'hear'],
                fullAnswer: ['can speak', 'can hear'],
                points: 1
            },
            q15: {
                modal: ['cant', 'cannot', 'can not', 'cant take', 'cannot take', 'can not take'],
                verb: ['take', 'use'],
                fullAnswer: ['cant take photos', 'cannot take photos', 'cant take pictures', 'cannot take pictures'],
                points: 1
            },
            q16: {
                modal: ['cant', 'cannot', 'can not', 'cant swim', 'cannot swim', 'can not swim', 'cant stay', 'cannot stay'],
                verb: ['swim', 'stay', 'go'],
                fullAnswer: ['cant swim', 'cannot swim', 'cant stay', 'cannot stay', 'cant go'],
                points: 1
            },
            q17: {
                keywords: ['home', 'apartment'],
                points: 1,
                type: 'simple'
            },
            q18: {
                keywords: ['pizza', 'making', 'cooking'],
                points: 1,
                type: 'simple'
            },
            q19: {
                keywords: ['lunch', 'restaurant', 'tapas', 'sangria', 'drinks', 'drinking', 'eating', 'shopping', 'buying', 'clothes', 'friends', 'fun', 'cafes', 'caf√©s'],
                requiredIdeas: 2,
                points: 2,
                type: 'multiple_ideas'
            },
            q20: {
                keywords: ['beach', 'reading', 'book', 'writing', 'email', 'message', 'watching', 'movie', 'tv', 'sleeping', 'sofa'],
                requiredIdeas: 2,
                points: 2,
                type: 'multiple_ideas'
            }
        };
        
        // Normalize text for comparison
        function normalizeText(text) {
            return text.toLowerCase()
                .trim()
                .replace(/[''¬¥`]/g, "'") // Normalize all apostrophe types
                .replace(/\s+/g, ' ') // Normalize spaces
                .replace(/[^a-z0-9'\s]/g, ''); // Keep letters, numbers, apostrophes, spaces
        }
        
        // Calculate grade
        function calculateGrade() {
            const studentName = document.getElementById('studentName').value.trim();
            
            if (!studentName) {
                alert('‚ö†Ô∏è Por favor ingresa tu nombre completo antes de calcular tu nota.');
                document.getElementById('studentName').focus();
                return;
            }
            
            // Check if all rubric criteria are selected
            const rubric1 = document.querySelector('input[name="rubric1"]:checked');
            const rubric2 = document.querySelector('input[name="rubric2"]:checked');
            const rubric3 = document.querySelector('input[name="rubric3"]:checked');
            const rubric4 = document.querySelector('input[name="rubric4"]:checked');
            
            if (!rubric1 || !rubric2 || !rubric3 || !rubric4) {
                alert('‚ö†Ô∏è Por favor completa todos los criterios de la r√∫brica de Writing antes de calcular tu nota.');
                return;
            }
            
            let listeningScore = 0;
            let readingScore = 0;
            const feedbackItems = [];
            
            // Grade Listening Part A (questions 1-6)
            for (let i = 1; i <= 6; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected && selected.value === answerKey[`q${i}`]) {
                    listeningScore++;
                    feedbackItems.push({
                        section: 'Listening Part A',
                        question: `Question ${i}`,
                        correct: true,
                        userAnswer: selected.value,
                        correctAnswer: answerKey[`q${i}`]
                    });
                } else {
                    feedbackItems.push({
                        section: 'Listening Part A',
                        question: `Question ${i}`,
                        correct: false,
                        userAnswer: selected ? selected.value : 'No answer',
                        correctAnswer: answerKey[`q${i}`]
                    });
                }
            }
            
            // Grade Listening Part B (questions 7-10)
            for (let i = 7; i <= 10; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                const correction = document.getElementById(`q${i}correction`).value.trim();
                
                if (selected) {
                    const isCorrect = selected.value === answerKey[`q${i}`];
                    if (isCorrect) {
                        if (selected.value === 'false' && correction) {
                            listeningScore += 1.5; // 1.5 points for correct T/F + correction
                        } else if (selected.value === 'true') {
                            listeningScore += 1.5; // 1.5 points for correct TRUE
                        } else {
                            listeningScore += 0.75; // Partial credit if FALSE selected but no correction
                        }
                    }
                    
                    feedbackItems.push({
                        section: 'Listening Part B',
                        question: `Question ${i}`,
                        correct: isCorrect,
                        userAnswer: `${selected.value.toUpperCase()}${correction ? ' - ' + correction : ''}`,
                        correctAnswer: answerKey[`q${i}`].toUpperCase()
                    });
                } else {
                    feedbackItems.push({
                        section: 'Listening Part B',
                        question: `Question ${i}`,
                        correct: false,
                        userAnswer: 'No answer',
                        correctAnswer: answerKey[`q${i}`].toUpperCase()
                    });
                }
            }
            
            // Grade Reading Part A (questions 11-16)
            let readingPartAScores = {};
            
            for (let i = 11; i <= 16; i++) {
                const userAnswer = document.getElementById(`q${i}`).value.trim();
                const normalized = normalizeText(userAnswer);
                const answerConfig = answerKey[`q${i}`];
                
                let pointsEarned = 0;
                let feedbackMessage = '';
                let isFullCorrect = false;
                let isPartialCorrect = false;
                
                // Check if full answer is correct
                for (let correct of answerConfig.fullAnswer) {
                    if (normalized === normalizeText(correct)) {
                        pointsEarned = answerConfig.points;
                        isFullCorrect = true;
                        feedbackMessage = 'Correct';
                        break;
                    }
                }
                
                // If not full correct, check for partial credit
                if (!isFullCorrect) {
                    let hasModal = false;
                    let hasVerb = false;
                    
                    // Check if modal is correct (can or can't)
                    for (let modal of answerConfig.modal) {
                        if (normalized.includes(normalizeText(modal))) {
                            hasModal = true;
                            break;
                        }
                    }
                    
                    // Check if verb is correct
                    for (let verb of answerConfig.verb) {
                        if (normalized.includes(normalizeText(verb))) {
                            hasVerb = true;
                            break;
                        }
                    }
                    
                    // Award partial credit
                    if (hasModal && hasVerb) {
                        // Both components present but maybe wrong order or extra words
                        pointsEarned = answerConfig.points;
                        isFullCorrect = true;
                        feedbackMessage = 'Correct';
                    } else if (hasModal || hasVerb) {
                        // Only one component correct
                        pointsEarned = answerConfig.points / 2;
                        isPartialCorrect = true;
                        if (hasModal && !hasVerb) {
                            feedbackMessage = 'Partial credit: modal correct, verb missing or incorrect';
                        } else {
                            feedbackMessage = 'Partial credit: verb correct, modal missing or incorrect';
                        }
                    } else {
                        feedbackMessage = `Correct answer: ${answerConfig.fullAnswer.join(' OR ')}`;
                    }
                }
                
                readingScore += pointsEarned;
                readingPartAScores[`q${i}`] = pointsEarned;
                
                feedbackItems.push({
                    section: 'Reading Part A',
                    question: `Question ${i - 10}`,
                    correct: isFullCorrect,
                    partial: isPartialCorrect,
                    userAnswer: userAnswer || 'No answer',
                    correctAnswer: feedbackMessage
                });
            }
            
            // Store scores globally
            globalScores.readingPartA = readingPartAScores;
            
            // Grade Reading Part B (questions 17-20)
            let readingPartBScores = {};
            
            for (let i = 17; i <= 20; i++) {
                const userAnswer = document.getElementById(`q${i}`).value.trim();
                const answerConfig = answerKey[`q${i}`];
                
                if (answerConfig.type === 'simple') {
                    // Questions 17-18 (1 point each)
                    const normalized = normalizeText(userAnswer);
                    let isCorrect = false;
                    
                    for (let keyword of answerConfig.keywords) {
                        if (normalized.includes(normalizeText(keyword))) {
                            isCorrect = true;
                            break;
                        }
                    }
                    
                    const pointsEarned = isCorrect ? answerConfig.points : 0;
                    readingScore += pointsEarned;
                    readingPartBScores[`q${i}`] = pointsEarned;
                    
                    feedbackItems.push({
                        section: 'Reading Part B',
                        question: `Question ${i - 16}`,
                        correct: isCorrect,
                        userAnswer: userAnswer || 'No answer',
                        correctAnswer: `Must include: ${answerConfig.keywords.join(' OR ')}`
                    });
                } else if (answerConfig.type === 'multiple_ideas') {
                    // Questions 19-20 (2 points each - requires multiple ideas)
                    const normalized = normalizeText(userAnswer);
                    let matchedKeywords = 0;
                    let foundKeywords = [];
                    
                    for (let keyword of answerConfig.keywords) {
                        if (normalized.includes(normalizeText(keyword))) {
                            matchedKeywords++;
                            foundKeywords.push(keyword);
                        }
                    }
                    
                    let pointsEarned = 0;
                    let feedbackMessage = '';
                    
                    if (matchedKeywords >= answerConfig.requiredIdeas) {
                        // Full credit
                        pointsEarned = answerConfig.points;
                        feedbackMessage = `Full credit (found ${matchedKeywords} relevant ideas)`;
                    } else if (matchedKeywords === 1) {
                        // Partial credit
                        pointsEarned = answerConfig.points / 2;
                        feedbackMessage = `Partial credit (found 1 idea, needs ${answerConfig.requiredIdeas})`;
                    } else {
                        feedbackMessage = `No credit (needs at least ${answerConfig.requiredIdeas} ideas)`;
                    }
                    
                    readingScore += pointsEarned;
                    readingPartBScores[`q${i}`] = pointsEarned;
                    
                    feedbackItems.push({
                        section: 'Reading Part B',
                        question: `Question ${i - 16}`,
                        correct: matchedKeywords >= answerConfig.requiredIdeas,
                        partial: matchedKeywords === 1,
                        userAnswer: userAnswer || 'No answer',
                        correctAnswer: feedbackMessage,
                        foundKeywords: foundKeywords.join(', ')
                    });
                }
            }
            
            // Store scores globally
            globalScores.readingPartB = readingPartBScores;
            
            // Populate automatic scores in override section
            for (let i = 11; i <= 16; i++) {
                document.getElementById(`autoScore${i}`).textContent = readingPartAScores[`q${i}`].toFixed(1);
            }
            for (let i = 17; i <= 20; i++) {
                document.getElementById(`autoScore${i}`).textContent = readingPartBScores[`q${i}`].toFixed(1);
            }
            
            // Get Writing score from rubric
            const writingScore = 
                parseFloat(rubric1.value) + 
                parseFloat(rubric2.value) + 
                parseFloat(rubric3.value) + 
                parseFloat(rubric4.value);
            
            // Store scores globally
            globalScores.listening = listeningScore;
            globalScores.reading = readingScore;
            globalScores.writing = writingScore;
            
            // Calculate totals
            const totalScore = listeningScore + readingScore + writingScore;
            const percentage = (totalScore / 36) * 100;
            globalScores.total = totalScore;
            
            // Chilean grading scale (60% = 4.0)
            let finalGrade;
            if (percentage < 60) {
                finalGrade = 1.0 + (percentage / 60) * 3.0;
            } else {
                finalGrade = 4.0 + ((percentage - 60) / 40) * 3.0;
            }
            finalGrade = Math.round(finalGrade * 10) / 10;
            
            // Display results
            displayResults(listeningScore, readingScore, writingScore, totalScore, percentage, finalGrade, feedbackItems);
            
            // Show manual override section
            document.getElementById('manualOverride').style.display = 'block';
        }
        
        // Function to display results
        function displayResults(listeningScore, readingScore, writingScore, totalScore, percentage, finalGrade, feedbackItems) {
            document.getElementById('listeningScore').textContent = `${listeningScore.toFixed(1)} / 12`;
            document.getElementById('readingScore').textContent = `${readingScore.toFixed(1)} / 12`;
            document.getElementById('writingScore').textContent = `${writingScore.toFixed(1)} / 12`;
            document.getElementById('totalScore').textContent = `${totalScore.toFixed(1)} / 36`;
            document.getElementById('percentage').textContent = `${percentage.toFixed(1)}%`;
            document.getElementById('finalGrade').textContent = finalGrade.toFixed(1);
            
            // Grade message
            let gradeMessage = '';
            if (finalGrade >= 6.0) {
                gradeMessage = 'üéâ ¬°Excelente trabajo! Est√°s muy bien preparado.';
            } else if (finalGrade >= 5.0) {
                gradeMessage = 'üëç ¬°Buen trabajo! Vas por buen camino.';
            } else if (finalGrade >= 4.0) {
                gradeMessage = 'üìö Aprobado. Sigue practicando para mejorar.';
            } else {
                gradeMessage = 'üí™ Necesitas m√°s pr√°ctica. ¬°No te rindas!';
            }
            document.getElementById('gradeMessage').textContent = gradeMessage;
            
            // Display feedback
            displayFeedback(feedbackItems);
            
            // Show results and scroll
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Function to display feedback
        function displayFeedback(feedbackItems) {
            const feedbackContainer = document.getElementById('feedbackContainer');
            feedbackContainer.innerHTML = '';
            
            let currentSection = '';
            feedbackItems.forEach(item => {
                if (item.section !== currentSection) {
                    const sectionHeader = document.createElement('h4');
                    sectionHeader.textContent = item.section;
                    sectionHeader.style.color = '#764ba2';
                    sectionHeader.style.marginTop = '20px';
                    sectionHeader.style.marginBottom = '10px';
                    feedbackContainer.appendChild(sectionHeader);
                    currentSection = item.section;
                }
                
                const feedbackItem = document.createElement('div');
                let itemClass = 'feedback-item';
                if (item.correct === true) {
                    itemClass += ' correct';
                } else if (item.partial === true) {
                    itemClass += ' partial';
                } else if (item.correct === false) {
                    itemClass += ' incorrect';
                }
                feedbackItem.className = itemClass;
                
                let feedbackHTML = `<div class="feedback-question">${item.question}</div>`;
                
                if (item.correct === null) {
                    feedbackHTML += `<div class="feedback-answer">Your answer: ${item.userAnswer}</div>`;
                    feedbackHTML += `<div class="feedback-answer" style="color: #666;">${item.correctAnswer}</div>`;
                } else if (item.correct) {
                    feedbackHTML += `<div class="feedback-answer correct">‚úì Correct: ${item.userAnswer}</div>`;
                    if (item.foundKeywords) {
                        feedbackHTML += `<div class="feedback-answer" style="color: #4caf50; font-size: 0.9em;">Keywords found: ${item.foundKeywords}</div>`;
                    }
                } else if (item.partial) {
                    feedbackHTML += `<div class="feedback-answer" style="color: #ff9800;">‚ö† Partial credit: ${item.userAnswer}</div>`;
                    feedbackHTML += `<div class="feedback-answer" style="color: #666;">${item.correctAnswer}</div>`;
                    if (item.foundKeywords) {
                        feedbackHTML += `<div class="feedback-answer" style="color: #ff9800; font-size: 0.9em;">Keywords found: ${item.foundKeywords}</div>`;
                    }
                } else {
                    feedbackHTML += `<div class="feedback-answer incorrect">‚úó Your answer: ${item.userAnswer}</div>`;
                    feedbackHTML += `<div class="feedback-answer correct">‚úì ${item.correctAnswer}</div>`;
                }
                
                feedbackItem.innerHTML = feedbackHTML;
                feedbackContainer.appendChild(feedbackItem);
            });
        }
        
        // Function to recalculate with manual overrides
        function recalculateWithOverrides() {
            // Get manual overrides for Reading Part A
            let newReadingPartAScore = 0;
            let hasOverrides = false;
            
            for (let i = 11; i <= 16; i++) {
                const manualInput = document.getElementById(`manualScore${i}`);
                const manualValue = manualInput.value.trim();
                
                if (manualValue !== '') {
                    // Use manual score
                    newReadingPartAScore += parseFloat(manualValue);
                    hasOverrides = true;
                } else {
                    // Use automatic score
                    newReadingPartAScore += globalScores.readingPartA[`q${i}`];
                }
            }
            
            // Get manual overrides for Reading Part B
            let newReadingPartBScore = 0;
            
            for (let i = 17; i <= 20; i++) {
                const manualInput = document.getElementById(`manualScore${i}`);
                const manualValue = manualInput.value.trim();
                
                if (manualValue !== '') {
                    // Use manual score
                    newReadingPartBScore += parseFloat(manualValue);
                    hasOverrides = true;
                } else {
                    // Use automatic score
                    newReadingPartBScore += globalScores.readingPartB[`q${i}`];
                }
            }
            
            if (!hasOverrides) {
                alert('‚ö†Ô∏è No has ingresado ning√∫n ajuste manual. Deja al menos un campo con un nuevo valor.');
                return;
            }
            
            // Calculate new reading score
            const newReadingScore = newReadingPartAScore + newReadingPartBScore;
            
            // Recalculate totals
            const totalScore = globalScores.listening + newReadingScore + globalScores.writing;
            const percentage = (totalScore / 36) * 100;
            
            // Chilean grading scale (60% = 4.0)
            let finalGrade;
            if (percentage < 60) {
                finalGrade = 1.0 + (percentage / 60) * 3.0;
            } else {
                finalGrade = 4.0 + ((percentage - 60) / 40) * 3.0;
            }
            finalGrade = Math.round(finalGrade * 10) / 10;
            
            // Update display
            document.getElementById('readingScore').textContent = `${newReadingScore.toFixed(1)} / 12`;
            document.getElementById('totalScore').textContent = `${totalScore.toFixed(1)} / 36`;
            document.getElementById('percentage').textContent = `${percentage.toFixed(1)}%`;
            document.getElementById('finalGrade').textContent = finalGrade.toFixed(1);
            // Update grade message
            let gradeMessage = '';
            if (finalGrade >= 6.0) {
                gradeMessage = 'üéâ ¬°Excelente trabajo! Est√°s muy bien preparado.';
            } else if (finalGrade >= 5.0) {
                gradeMessage = 'üëç ¬°Buen trabajo! Vas por buen camino.';
            } else if (finalGrade >= 4.0) {
                gradeMessage = 'üìö Aprobado. Sigue practicando para mejorar.';
            } else {
                gradeMessage = 'üí™ Necesitas m√°s pr√°ctica. ¬°No te rindas!';
            }
            document.getElementById('gradeMessage').textContent = gradeMessage;
            
            // Scroll to results
            document.getElementById('finalGrade').scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            alert('‚úÖ Nota recalculada con los ajustes manuales del Reading Comprehension.');
        }
    </script>
</body>
</html>
